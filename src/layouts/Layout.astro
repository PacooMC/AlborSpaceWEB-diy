---
    import Navigation from '../components/Navigation.astro';
    import Footer from '../components/Footer.astro';
    import '../styles/global.css';
    // Import icons needed for the modal
    import { Mail, MapPin } from 'lucide-astro';
    // Import the new image
    import horizonImage from '../assets/Planet-horizon.jpeg';

    interface Props {
      title?: string;
      description?: string;
    }

    const {
      title = "ALBOR SPACE - Advanced Satellite Communication Systems",
      description = "Next generation satellite communication systems for space exploration."
    } = Astro.props;
    ---

    <!doctype html>
    <html lang="en" class="dark">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <meta name="description" content={description} />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
        <title>{title}</title>
      </head>
      <body class="bg-black text-white min-h-screen overflow-x-hidden">
        <!-- Fixed background with the new planet horizon image -->
        <div class="fixed inset-0 bg-black z-[-10]"></div>

        <!-- Planet horizon background with enhanced sunrise effect -->
        <div class="fixed inset-0 z-[-8] overflow-hidden">
          <div id="horizon-container" class="absolute inset-0 w-full h-full">
            <!-- Planet horizon image -->
            <img 
              src={horizonImage.src} 
              alt="Planet horizon" 
              class="w-full h-full object-cover object-bottom opacity-80" 
              id="horizon-image"
            />
            
            <!-- Enhanced sunrise overlay layers -->
            <div class="absolute inset-0 bg-gradient-to-b from-slate-900/90 via-slate-800/70 to-orange-900/30"></div>
            <div class="absolute bottom-0 w-full h-2/3 bg-gradient-to-t from-orange-500/20 via-orange-600/10 to-transparent"></div>
            <div class="absolute bottom-0 w-full h-1/2 bg-gradient-to-t from-yellow-500/10 to-transparent"></div>
            
            <!-- Dynamic sunrise glow that appears on scroll to top -->
            <div id="sunrise-glow" class="absolute top-0 w-full h-full bg-gradient-to-b from-orange-400/30 via-orange-500/15 to-transparent opacity-0 transition-all duration-1000 ease-out blur-sm"></div>
          </div>
        </div>

        <!-- Enhanced star field background -->
        <div id="star-field" class="fixed inset-0 z-[-5]"></div>

        <!-- Sunrise effect for navigation and sections -->
        <div id="nav-sunrise" class="nav-sunrise"></div>

        <!-- Smooth section transitions overlay -->
        <div id="section-transitions" class="fixed inset-0 z-[-6] pointer-events-none">
          <div class="absolute inset-0 bg-gradient-to-b from-transparent via-orange-500/5 to-transparent opacity-0 transition-opacity duration-1000" id="transition-glow"></div>
        </div>

        <Navigation />

        <main class="relative z-10">
          <slot />
        </main>

        <Footer />

        <!-- Modal for expanded member details -->
        <div id="member-modal" class="fixed inset-0 z-50 flex items-center justify-center px-4 hidden">
          <div class="absolute inset-0 bg-dark-900/98 backdrop-blur-2xl opacity-0 transition-opacity duration-500"></div>
          <div class="relative bg-dark-800/70 rounded-2xl border border-white/10 p-8 max-w-4xl w-full transform scale-95 opacity-0 transition-all duration-500 backdrop-blur-xl shadow-2xl">
            <button id="close-modal" class="absolute top-4 right-4 text-white/50 hover:text-white">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <div class="flex flex-col md:flex-row gap-8">
              <div class="w-full md:w-1/3">
                <div class="rounded-xl overflow-hidden mb-6 ring-1 ring-white/10 shadow-xl">
                  <img id="modal-image" src="" alt="" class="w-full aspect-square object-cover">
                </div>

                <!-- Contact info -->
                <div class="space-y-4 p-4 bg-dark-900/50 rounded-xl border border-white/5">
                  <h4 class="text-sm uppercase tracking-wider text-white/50 mb-3">Contact Information</h4>

                  <a id="modal-email" href="" class="flex items-center text-white/50 hover:text-white group">
                    <Mail size={20} class="mr-2 text-orange-400/70" />
                    <span class="text-sm group-hover:text-orange-400 transition-colors duration-200"></span>
                  </a>

                  <div class="flex items-start text-white/50">
                    <MapPin size={20} class="mr-2 shrink-0 text-orange-400/70 mt-0.5" />
                    <div>
                      <p class="text-sm">Departamento de Ingeniería de Comunicaciones</p>
                      <p class="text-sm">ETSI Telecomunicación</p>
                      <p class="text-sm">Universidad de Málaga</p>
                      <p class="text-sm">Campus de Teatinos, 29071 Málaga, Spain</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="w-full md:w-2/3">
                <h3 id="modal-name" class="text-2xl font-light mb-2 text-gradient-orange-soft"></h3>
                <p id="modal-role" class="text-orange-400/90 text-sm tracking-wider uppercase mb-6"></p>

                <div class="prose prose-invert prose-sm max-w-none">
                  <p id="modal-bio" class="text-white/70 leading-relaxed mb-8"></p>

                  <!-- Education -->
                  <div class="mb-8">
                    <h4 class="text-lg font-light mb-4 text-white">Education</h4>
                    <ul id="modal-education" class="space-y-2 text-white/60"></ul>
                  </div>

                  <!-- Expertise -->
                  <div class="mb-8">
                    <h4 class="text-lg font-light mb-4 text-white">Areas of Expertise</h4>
                    <div id="modal-expertise" class="flex flex-wrap gap-2"></div>
                  </div>

                  <!-- Stats -->
                  <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="bg-orange-400/5 rounded-lg p-4 border border-orange-400/10">
                      <div id="modal-publications" class="text-2xl font-light text-orange-400 mb-2"></div>
                      <div class="text-sm text-white/50">Publications</div>
                    </div>
                    <div class="bg-orange-400/5 rounded-lg p-4 border border-orange-400/10">
                      <div id="modal-patents" class="text-2xl font-light text-orange-400 mb-2"></div>
                      <div class="text-sm text-white/50">Patents</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <style is:global>
          /* Enhanced background with sunrise theme */
          #horizon-container {
            position: relative;
            overflow: hidden;
          }

          #horizon-image {
            transition: opacity 0.3s ease, transform 0.3s ease;
          }

          /* Sunrise effect that appears at the top of the page */
          .nav-sunrise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 25vh;
            background: radial-gradient(ellipse 100% 60% at center top, 
              rgba(255, 140, 0, 0.4) 0%, 
              rgba(255, 165, 0, 0.2) 30%, 
              rgba(255, 69, 0, 0.1) 60%, 
              transparent 100%);
            opacity: 0;
            pointer-events: none;
            z-index: 1;
            transition: opacity 1s ease-out;
            filter: blur(1px);
          }

          .nav-sunrise.sunriseActive {
            opacity: 1;
          }

          /* Smooth section transitions */
          .section-transition {
            position: relative;
            z-index: 10;
          }

          .section-transition::before {
            content: '';
            position: absolute;
            top: -100px;
            left: 0;
            right: 0;
            height: 200px;
            background: linear-gradient(to bottom, 
              transparent 0%, 
              rgba(255, 140, 0, 0.05) 50%, 
              transparent 100%);
            opacity: 0;
            transition: opacity 0.8s ease;
            pointer-events: none;
          }

          .section-transition.in-view::before {
            opacity: 1;
          }

          /* Enhanced star animations */
          .star {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: twinkle 3s infinite;
          }

          @keyframes twinkle {
            0%, 100% { 
              opacity: 0.3; 
              transform: scale(1);
            }
            50% { 
              opacity: 1; 
              transform: scale(1.2);
            }
          }

          /* Modal styles */
          .expertise-tag {
            background-color: theme('colors.orange.400 / 15%');
            color: rgba(255, 255, 255, 0.8);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            border: 1px solid theme('colors.orange.400 / 25%');
            transition: all 0.3s ease;
          }

          .expertise-tag:hover {
            background-color: theme('colors.orange.400 / 20%');
            border-color: theme('colors.orange.400 / 35%');
            transform: translateY(-1px);
          }

          .text-gradient-orange-soft {
            background: linear-gradient(to right, #fff, theme('colors.orange.300'));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
          }

          /* Smooth reveal animations */
          .reveal-element {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
          }

          .reveal-element.revealed {
            opacity: 1;
            transform: translateY(0);
          }

          /* Enhanced section styling */
          .section {
            position: relative;
            transition: all 0.6s ease;
          }

          /* Sunrise gradient borders for sections */
          .section-border {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 1px;
            background: linear-gradient(90deg, 
              transparent 0%, 
              rgba(255, 140, 0, 0.3) 20%, 
              rgba(255, 165, 0, 0.5) 50%, 
              rgba(255, 140, 0, 0.3) 80%, 
              transparent 100%);
            opacity: 0;
            transition: opacity 0.8s ease;
          }

          .section.in-view .section-border {
            opacity: 1;
          }
        </style>

        <script>
          // Global Modal Logic
          const modal = document.getElementById('member-modal');
          const modalOverlay = modal?.querySelector('div');
          const modalContent = modal?.querySelector('div:nth-child(2)');
          const closeButton = document.getElementById('close-modal');

          const modalImage = document.getElementById('modal-image');
          const modalName = document.getElementById('modal-name');
          const modalRole = document.getElementById('modal-role');
          const modalBio = document.getElementById('modal-bio');
          const modalEmail = document.getElementById('modal-email');
          const modalEducation = document.getElementById('modal-education');
          const modalExpertise = document.getElementById('modal-expertise');
          const modalPublications = document.getElementById('modal-publications');
          const modalPatents = document.getElementById('modal-patents');

          // Make openModal globally accessible
          window.openModal = function(member) {
            if (modal && modalOverlay && modalContent) {
              modal.classList.remove('hidden');
              document.body.style.overflow = 'hidden';
              setTimeout(() => {
                modalOverlay.classList.add('opacity-100');
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
              }, 10);

              if (modalImage) {
                modalImage.src = member.image;
                modalImage.alt = member.name;
              }
              if (modalName) modalName.textContent = member.name;
              if (modalRole) modalRole.textContent = member.role;
              if (modalBio) modalBio.textContent = member.bio || 'No bio available.';

              // Email
              if (modalEmail) {
                const emailSpan = modalEmail.querySelector('span');
                if (member.email) {
                  modalEmail.href = `mailto:${member.email}`;
                  if (emailSpan) emailSpan.textContent = member.email;
                  modalEmail.style.display = 'flex';
                } else {
                  modalEmail.style.display = 'none';
                }
              }

              // Education
              if (modalEducation) {
                modalEducation.innerHTML = member.education?.map(edu =>
                  `<li class="flex items-start">
                    <span class="w-1.5 h-1.5 rounded-full bg-orange-400/60 mt-1.5 mr-3 shrink-0"></span>
                    ${edu}
                  </li>`
                ).join('') || '<li>No education information available.</li>';
              }

              // Expertise
              if (modalExpertise) {
                modalExpertise.innerHTML = member.expertise?.map(exp =>
                  `<span class="expertise-tag">${exp}</span>`
                ).join('') || '<span class="text-white/50 text-sm">No expertise listed.</span>';
              }

              // Stats
              if (modalPublications) modalPublications.textContent = member.publications?.toString() || '0';
              if (modalPatents) modalPatents.textContent = member.patents?.toString() || '0';
            }
          }

          // Make closeModal globally accessible
          window.closeModal = function() {
            if (modal && modalOverlay && modalContent) {
              modalOverlay.classList.remove('opacity-100');
              modalContent.classList.remove('scale-100', 'opacity-100');
              modalContent.classList.add('scale-95', 'opacity-0');
              document.body.style.overflow = '';

              setTimeout(() => {
                modal.classList.add('hidden');
              }, 300);
            }
          }

          // Global event listeners for the modal
          closeButton?.addEventListener('click', window.closeModal);

          modalOverlay?.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
              window.closeModal();
            }
          });

          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
              window.closeModal();
            }
          });

          // Enhanced page initialization
          document.addEventListener('DOMContentLoaded', () => {
            // Enhanced stars background with sunrise colors
            const starField = document.getElementById('star-field');
            if (starField) {
              starField.innerHTML = '';

              const fragment = document.createDocumentFragment();
              for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.classList.add('star');

                const size = Math.random() > 0.85 ? Math.random() * 3 + 1.5 :
                         Math.random() > 0.7 ? Math.random() * 2 + 0.8 :
                         Math.random() * 1 + 0.3;

                // Enhanced star coloring with sunrise theme
                let color;
                const random = Math.random();
                if (random > 0.95) {
                  color = 'rgba(255, 140, 0, 0.9)'; // Orange stars
                } else if (random > 0.90) {
                  color = 'rgba(255, 180, 120, 0.8)'; // Warm white
                } else {
                  color = 'rgba(255, 255, 255, 0.7)'; // Regular white
                }

                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.backgroundColor = color;

                star.style.animationDelay = `${Math.random() * 5}s`;
                star.style.animationDuration = `${Math.random() * 3 + 2}s`;

                if (size > 2) {
                  star.style.boxShadow = `0 0 ${size * 2}px ${color}`;
                }

                fragment.appendChild(star);
              }
              starField.appendChild(fragment);
            }

            // Enhanced scroll effects with sunrise theme
            const horizonImage = document.getElementById('horizon-image');
            const sunriseGlow = document.getElementById('sunrise-glow');
            const navSunrise = document.getElementById('nav-sunrise');
            const transitionGlow = document.getElementById('transition-glow');

            // Enhanced section observers for sunrise effects
            const sectionObserver = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                if (entry.isIntersecting) {
                  entry.target.classList.add('isIntersecting', 'in-view');
                  
                  // Add section border if it doesn't exist
                  if (!entry.target.querySelector('.section-border')) {
                    const border = document.createElement('div');
                    border.className = 'section-border';
                    entry.target.appendChild(border);
                  }
                } else {
                  entry.target.classList.remove('isIntersecting', 'in-view');
                }

                // Enhanced sunrise effect
                if (navSunrise && transitionGlow) {
                  const intersectingSections = document.querySelectorAll('.section.isIntersecting');
                  let maxIntensity = 0;

                  intersectingSections.forEach(intersectingSection => {
                    const boundingRect = intersectingSection.getBoundingClientRect();
                    const viewportHeight = window.innerHeight;
                    let intensity = 0;

                    if (boundingRect.top < viewportHeight && boundingRect.bottom > 0) {
                       const visibleHeight = Math.min(boundingRect.bottom, viewportHeight) - Math.max(boundingRect.top, 0);
                       intensity = visibleHeight / viewportHeight;
                    }
                    maxIntensity = Math.max(maxIntensity, intensity);
                  });

                  navSunrise.style.opacity = Math.min(maxIntensity * 0.8, 0.8);
                  transitionGlow.style.opacity = Math.min(maxIntensity * 0.6, 0.6);

                  if (intersectingSections.length > 0) {
                     navSunrise.classList.add('sunriseActive');
                  } else {
                     navSunrise.classList.remove('sunriseActive');
                     setTimeout(() => {
                       if (document.querySelectorAll('.section.isIntersecting').length === 0) {
                         navSunrise.style.opacity = '0';
                         transitionGlow.style.opacity = '0';
                       }
                     }, 300);
                  }
                }
              });
            }, {
              threshold: Array.from({ length: 21 }, (_, i) => i * 0.05),
              rootMargin: "-5% 0px -5% 0px"
            });

            // Observe all sections
            document.querySelectorAll('section, .section').forEach(section => {
              section.classList.add('section', 'section-transition');
              sectionObserver.observe(section);
            });

            // Enhanced scroll effect for dynamic sunrise
            let ticking = false;
            window.addEventListener('scroll', () => {
              if (!ticking) {
                requestAnimationFrame(() => {
                  const scrollY = window.scrollY;
                  const scrollPercentage = Math.min(scrollY / (window.innerHeight * 0.5), 1);

                  // Enhanced background effects
                  if (horizonImage && sunriseGlow) {
                    // Sunrise glow appears when scrolled to top
                    if (scrollY < 100) {
                      const topIntensity = Math.max(1 - (scrollY / 100), 0);
                      sunriseGlow.style.opacity = topIntensity * 0.7;
                    } else {
                      sunriseGlow.style.opacity = '0';
                    }

                    // Subtle parallax effect on background
                    const parallaxOffset = scrollY * 0.5;
                    horizonImage.style.transform = `translateY(${parallaxOffset}px) scale(1.1)`;
                  }

                  ticking = false;
                });
                ticking = true;
              }
            });

            // Initial sunrise effect for page load
            if (sunriseGlow) {
              setTimeout(() => {
                sunriseGlow.style.opacity = '0.7';
                setTimeout(() => {
                  sunriseGlow.style.opacity = '0';
                }, 2000);
              }, 500);
            }
          });
        </script>
      </body>
    </html>