---
    import Navigation from '../components/Navigation.astro';
    import Footer from '../components/Footer.astro';
    import '../styles/global.css';
    // Import icons needed for the modal
    import { Mail, MapPin } from 'lucide-astro';
    // Import the new image
    import horizonImage from '../assets/Planet-horizon.jpeg';

    interface Props {
      title?: string;
      description?: string;
    }

    const {
      title = "ALBOR SPACE - Advanced Satellite Communication Systems",
      description = "Next generation satellite communication systems for space exploration."
    } = Astro.props;
    ---

    <!doctype html>
    <html lang="en" class="dark">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <meta name="description" content={description} />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
        <title>{title}</title>
      </head>
      <body class="text-white min-h-screen overflow-x-hidden">
        <!-- Ultra dark navy background - almost black with subtle blue tint -->
        <div class="fixed inset-0 z-[-10] ultra-dark-navy-bg"></div>

        <!-- Very subtle gradient overlay for minimal depth -->
        <div class="fixed inset-0 z-[-9] ultra-dark-overlay"></div>

        <!-- Enhanced planet horizon background -->
        <div class="fixed inset-0 z-[-8] overflow-hidden">
          <div id="horizon-container" class="absolute inset-0 w-full h-full">
            <!-- Planet horizon image with better visibility on ultra dark background -->
            <img 
              src={horizonImage.src} 
              alt="Planet horizon" 
              class="w-full h-full object-cover object-bottom opacity-25" 
              id="horizon-image"
            />
            
            <!-- Ultra dark overlay for seamless integration -->
            <div class="absolute inset-0 bg-gradient-to-t from-[#000012]/95 via-[#000018]/70 to-transparent"></div>
          </div>
        </div>

        <!-- Enhanced star field background -->
        <div id="star-field" class="fixed inset-0 z-[-5]"></div>

        <Navigation />

        <main class="relative z-10">
          <slot />
        </main>

        <Footer />

        <!-- Modal for expanded member details -->
        <div id="member-modal" class="fixed inset-0 z-50 flex items-center justify-center px-4 hidden">
          <div class="absolute inset-0 bg-[#000012]/98 backdrop-blur-2xl opacity-0 transition-opacity duration-500"></div>
          <div class="relative bg-[#000018]/95 rounded-2xl border border-white/8 p-8 max-w-4xl w-full transform scale-95 opacity-0 transition-all duration-500 backdrop-blur-xl shadow-2xl">
            <button id="close-modal" class="absolute top-4 right-4 text-white/50 hover:text-white">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>

            <div class="flex flex-col md:flex-row gap-8">
              <div class="w-full md:w-1/3">
                <div class="rounded-xl overflow-hidden mb-6 ring-1 ring-white/10 shadow-xl">
                  <img id="modal-image" src="" alt="" class="w-full aspect-square object-cover">
                </div>

                <!-- Contact info -->
                <div class="space-y-4 p-4 bg-[#000012]/70 rounded-xl border border-white/5">
                  <h4 class="text-sm uppercase tracking-wider text-white/50 mb-3">Contact Information</h4>

                  <a id="modal-email" href="" class="flex items-center text-white/50 hover:text-white group">
                    <Mail size={20} class="mr-2 text-[#FF6B00]/70" />
                    <span class="text-sm group-hover:text-[#FF6B00] transition-colors duration-200"></span>
                  </a>

                  <div class="flex items-start text-white/50">
                    <MapPin size={20} class="mr-2 shrink-0 text-[#FF6B00]/70 mt-0.5" />
                    <div>
                      <p class="text-sm">Departamento de Ingeniería de Comunicaciones</p>
                      <p class="text-sm">ETSI Telecomunicación</p>
                      <p class="text-sm">Universidad de Málaga</p>
                      <p class="text-sm">Campus de Teatinos, 29071 Málaga, Spain</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="w-full md:w-2/3">
                <h3 id="modal-name" class="text-2xl font-light mb-2 text-gradient-orange-soft"></h3>
                <p id="modal-role" class="text-[#FF6B00]/90 text-sm tracking-wider uppercase mb-6"></p>

                <div class="prose prose-invert prose-sm max-w-none">
                  <p id="modal-bio" class="text-white/70 leading-relaxed mb-8"></p>

                  <!-- Education -->
                  <div class="mb-8">
                    <h4 class="text-lg font-light mb-4 text-white">Education</h4>
                    <ul id="modal-education" class="space-y-2 text-white/60"></ul>
                  </div>

                  <!-- Expertise -->
                  <div class="mb-8">
                    <h4 class="text-lg font-light mb-4 text-white">Areas of Expertise</h4>
                    <div id="modal-expertise" class="flex flex-wrap gap-2"></div>
                  </div>

                  <!-- Stats -->
                  <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="bg-[#FF6B00]/5 rounded-lg p-4 border border-[#FF6B00]/10">
                      <div id="modal-publications" class="text-2xl font-light text-[#FF6B00] mb-2"></div>
                      <div class="text-sm text-white/50">Publications</div>
                    </div>
                    <div class="bg-[#FF6B00]/5 rounded-lg p-4 border border-[#FF6B00]/10">
                      <div id="modal-patents" class="text-2xl font-light text-[#FF6B00] mb-2"></div>
                      <div class="text-sm text-white/50">Patents</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <style is:global>
          /* Ultra dark navy background - almost black with very subtle blue tint */
          .ultra-dark-navy-bg {
            background: linear-gradient(135deg, 
              #000012 0%, 
              #000018 25%, 
              #000024 50%, 
              #000030 75%, 
              #000012 100%);
          }

          /* Very subtle gradient overlay for minimal depth */
          .ultra-dark-overlay {
            background: radial-gradient(ellipse at center, 
              transparent 0%, 
              rgba(0, 0, 24, 0.1) 50%, 
              rgba(0, 0, 36, 0.2) 100%);
            animation: subtlePulse 12s ease-in-out infinite alternate;
          }

          @keyframes subtlePulse {
            0% { opacity: 0.1; }
            100% { opacity: 0.3; }
          }

          /* Enhanced planet horizon background */
          #horizon-container {
            position: relative;
            overflow: hidden;
          }

          #horizon-image {
            transition: opacity 0.3s ease, transform 0.3s ease;
            filter: contrast(1.2) brightness(0.8);
          }

          /* Enhanced star animations with ultra dark background */
          .star {
            position: absolute;
            border-radius: 50%;
            animation: twinkleOnUltraDark 6s infinite;
          }

          @keyframes twinkleOnUltraDark {
            0%, 100% { 
              opacity: 0.5; 
              transform: scale(1);
            }
            50% { 
              opacity: 1; 
              transform: scale(1.2);
            }
          }

          /* Modal styles with ultra dark theme */
          .expertise-tag {
            background-color: rgba(255, 107, 0, 0.15);
            color: rgba(255, 255, 255, 0.8);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            border: 1px solid rgba(255, 107, 0, 0.25);
            transition: all 0.3s ease;
          }

          .expertise-tag:hover {
            background-color: rgba(255, 107, 0, 0.25);
            border-color: rgba(255, 107, 0, 0.4);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(255, 107, 0, 0.2);
          }

          .text-gradient-orange-soft {
            background: linear-gradient(to right, #fff, #FF6B00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
          }

          /* Smooth reveal animations */
          .reveal-element {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
          }

          .reveal-element.revealed {
            opacity: 1;
            transform: translateY(0);
          }
        </style>

        <script>
          // Global Modal Logic
          const modal = document.getElementById('member-modal');
          const modalOverlay = modal?.querySelector('div');
          const modalContent = modal?.querySelector('div:nth-child(2)');
          const closeButton = document.getElementById('close-modal');

          const modalImage = document.getElementById('modal-image');
          const modalName = document.getElementById('modal-name');
          const modalRole = document.getElementById('modal-role');
          const modalBio = document.getElementById('modal-bio');
          const modalEmail = document.getElementById('modal-email');
          const modalEducation = document.getElementById('modal-education');
          const modalExpertise = document.getElementById('modal-expertise');
          const modalPublications = document.getElementById('modal-publications');
          const modalPatents = document.getElementById('modal-patents');

          // Make openModal globally accessible
          window.openModal = function(member) {
            if (modal && modalOverlay && modalContent) {
              modal.classList.remove('hidden');
              document.body.style.overflow = 'hidden';
              setTimeout(() => {
                modalOverlay.classList.add('opacity-100');
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
              }, 10);

              if (modalImage) {
                modalImage.src = member.image;
                modalImage.alt = member.name;
              }
              if (modalName) modalName.textContent = member.name;
              if (modalRole) modalRole.textContent = member.role;
              if (modalBio) modalBio.textContent = member.bio || 'No bio available.';

              // Email
              if (modalEmail) {
                const emailSpan = modalEmail.querySelector('span');
                if (member.email) {
                  modalEmail.href = `mailto:${member.email}`;
                  if (emailSpan) emailSpan.textContent = member.email;
                  modalEmail.style.display = 'flex';
                } else {
                  modalEmail.style.display = 'none';
                }
              }

              // Education
              if (modalEducation) {
                modalEducation.innerHTML = member.education?.map(edu =>
                  `<li class="flex items-start">
                    <span class="w-1.5 h-1.5 rounded-full bg-[#FF6B00]/60 mt-1.5 mr-3 shrink-0"></span>
                    ${edu}
                  </li>`
                ).join('') || '<li>No education information available.</li>';
              }

              // Expertise
              if (modalExpertise) {
                modalExpertise.innerHTML = member.expertise?.map(exp =>
                  `<span class="expertise-tag">${exp}</span>`
                ).join('') || '<span class="text-white/50 text-sm">No expertise listed.</span>';
              }

              // Stats
              if (modalPublications) modalPublications.textContent = member.publications?.toString() || '0';
              if (modalPatents) modalPatents.textContent = member.patents?.toString() || '0';
            }
          }

          // Make closeModal globally accessible
          window.closeModal = function() {
            if (modal && modalOverlay && modalContent) {
              modalOverlay.classList.remove('opacity-100');
              modalContent.classList.remove('scale-100', 'opacity-100');
              modalContent.classList.add('scale-95', 'opacity-0');
              document.body.style.overflow = '';

              setTimeout(() => {
                modal.classList.add('hidden');
              }, 300);
            }
          }

          // Global event listeners for the modal
          closeButton?.addEventListener('click', window.closeModal);

          modalOverlay?.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
              window.closeModal();
            }
          });

          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
              window.closeModal();
            }
          });

          // Enhanced page initialization with ultra dark theme
          document.addEventListener('DOMContentLoaded', () => {
            // Enhanced stars background with better visibility on ultra dark
            const starField = document.getElementById('star-field');
            if (starField) {
              starField.innerHTML = '';

              const fragment = document.createDocumentFragment();
              for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.classList.add('star');

                // Enhanced star sizing for ultra dark background
                const size = Math.random() > 0.92 ? Math.random() * 2.5 + 1.5 :
                         Math.random() > 0.8 ? Math.random() * 1.5 + 0.8 :
                         Math.random() * 0.8 + 0.4;

                // Enhanced star coloring for ultra dark background
                let color;
                const random = Math.random();
                if (random > 0.96) {
                  color = 'rgba(255, 107, 0, 0.9)'; // Orange stars for accents
                } else if (random > 0.90) {
                  color = 'rgba(255, 255, 255, 1)'; // Bright white stars
                } else if (random > 0.75) {
                  color = 'rgba(200, 220, 255, 0.9)'; // Slightly blue-tinted stars
                } else {
                  color = 'rgba(255, 255, 255, 0.7)'; // Regular white stars
                }

                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.backgroundColor = color;

                star.style.animationDelay = `${Math.random() * 10}s`;
                star.style.animationDuration = `${Math.random() * 8 + 5}s`;

                if (size > 1.5) {
                  star.style.boxShadow = `0 0 ${size * 4}px ${color}`;
                }

                fragment.appendChild(star);
              }
              starField.appendChild(fragment);
            }

            // Enhanced scroll effects with ultra dark background
            const horizonImage = document.getElementById('horizon-image');

            let ticking = false;
            window.addEventListener('scroll', () => {
              if (!ticking) {
                requestAnimationFrame(() => {
                  const scrollY = window.scrollY;

                  // Enhanced parallax effect
                  if (horizonImage) {
                    const parallaxOffset = scrollY * 0.2;
                    horizonImage.style.transform = `translateY(${parallaxOffset}px) scale(1.05)`;
                  }

                  ticking = false;
                });
                ticking = true;
              }
            });
          });
        </script>
      </body>
    </html>